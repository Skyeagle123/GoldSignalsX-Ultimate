<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>GoldSignalsX â€“ Mobile</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0f17">
  <style>
    :root{
      --bg:#0b0f17; --fg:#e5e7eb; --muted:#9ca3af; --card:#111827; --card2:#0f172a; --accent:#f59e0b;
      --ok:#10b981; --bad:#ef4444; --line:#1f2937
    }
    :root.light{
      --bg:#f9fafb; --fg:#0b1220; --muted:#6b7280; --card:#ffffff; --card2:#f3f4f6; --accent:#ca8a04;
      --ok:#059669; --bad:#dc2626; --line:#e5e7eb
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial}
    header{position:sticky;top:0;background:var(--card2);display:flex;align-items:center;justify-content:space-between;padding:10px 12px;z-index:20;border-bottom:1px solid var(--line)}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .icon{font-size:20px}
    .brand h1{margin:0;font-size:16px}
    .brand .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .right{display:flex;align-items:center;gap:8px}
    button, input, select{background:var(--card);border:1px solid var(--line);color:var(--fg);border-radius:10px;padding:8px 10px}
    button{cursor:pointer}
    .primary{background:var(--accent);color:#111827;border-color:transparent;font-weight:700}
    .chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;background:var(--card2)}
    .card{background:var(--card);border-radius:16px;padding:12px;margin:10px;border:1px solid var(--line)}
    .title{font-size:13px;color:var(--muted);margin-bottom:6px}
    .value{font-size:20px;font-weight:800}
    canvas{width:100%;height:280px;background:var(--card2);border-radius:12px}
    .small{font-size:12px;color:var(--muted)}
    /* Tabs */
    nav.tabs{position:fixed;bottom:0;left:0;right:0;background:var(--card2);border-top:1px solid var(--line);display:flex;z-index:30}
    nav.tabs button{flex:1;padding:10px;border-radius:0;border:none;border-right:1px solid var(--line);background:var(--card2);color:var(--fg)}
    nav.tabs button.active{background:var(--accent);color:#111827;font-weight:800}
    nav.tabs button:hover{filter:brightness(1.1)}
    main{padding-bottom:64px}
    .row{display:flex;flex-wrap:wrap;align-items:center;gap:8px}
    #log{white-space:pre-wrap;font-family:ui-monospace,Menlo,Consolas,monospace;background:var(--card2);padding:10px;border-radius:10px;max-height:200px;overflow:auto}
    #toast{position:fixed;left:8px;right:8px;bottom:-200px;background:var(--card);border:1px solid var(--line);border-radius:16px;padding:12px;z-index:40;box-shadow:0 10px 30px rgba(0,0,0,.35);transition:transform .35s, bottom .35s}
    #toast.show{bottom:70px}
    #toast .t-row{display:flex;align-items:center;gap:10px}
    #toast .t-title{font-weight:800}
    #toast .t-btn{margin-inline-start:auto;background:transparent;border:1px solid var(--line);border-radius:999px;padding:6px 10px}
    #flash{position:fixed;inset:0;background:rgba(245,158,11,.2);pointer-events:none;opacity:0;transition:opacity .35s;z-index:35}
    #flash.on{opacity:1}
    .nice-table{width:100%;border-collapse:collapse}
    .nice-table th,.nice-table td{border:1px solid var(--line);padding:6px;text-align:center}
    .nice-table th{background:var(--card)}
    .nice-table tr:nth-child(even){background-color:rgba(255,255,255,.03)}
    .nice-table .pivot{color:#facc15;font-weight:800}
    .nice-table .res{color:#f87171}
    .nice-table .sup{color:#4ade80}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="icon">ğŸ”±</div>
      <div>
        <h1>GoldSignalsX</h1>
        <div class="sub">Smart Gold Trading Signals</div>
      </div>
    </div>
    <div class="right">
      <span class="chip">Ø§Ù„Ø³Ø¹Ø±: <b id="price">â€”</b>
        <div id="liveDateTime" class="small" style="opacity:.9;margin-top:2px">â€”</div>
      </span>
      <button id="themeBtn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…">ğŸŒ™</button>
    </div>
  </header>

  <main>
    <!-- Home / Chart -->
    <section id="tab-home" class="tab card">
      <div class="row">
        <label>Worker URL</label>
        <input id="base" size="28" placeholder="https://alsx-worker.samer-mourtada.workers.dev">
        <button id="saveBase">Ø­ÙØ¸</button>
        <button id="btnPrice">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø±</button>
      </div>

      <div class="row" style="margin-top:8px">
        <div class="row" id="tfBar">
          <button data-tf="1m" class="primary">1Ø¯</button>
          <button data-tf="5m">5Ø¯</button>
          <button data-tf="15m">15Ø¯</button>
          <button data-tf="30m">30Ø¯</button>
          <button data-tf="60m">60Ø¯</button>
          <button data-tf="240m">240Ø¯</button>
          <button data-tf="1d">ÙŠÙˆÙ…</button>
        </div>
        <label>Limit</label>
        <input id="limit" type="number" min="300" max="5000" step="50" value="1200">
        <button id="btnBars" class="primary">Ø¬Ù„Ø¨ Ø§Ù„Ø´Ù…ÙˆØ¹</button>
        <button id="btnCSV">CSV</button>
      </div>

      <div class="row" style="margin-top:6px;gap:10px">
        <span class="chip">Ø§Ù„Ø­Ø§Ù„Ø©: <b id="regimeTop">â€”</b></span>
        <span class="chip">Ø§Ù„ÙˆØ¶Ø¹: <b id="modeTop">Ø°ÙƒÙŠ</b></span>
      </div>

      <div class="title" style="margin-top:8px">Ø§Ù„Ø´Ø§Ø±Øª Ø§Ù„Ø­ÙŠ</div>
      <div class="title" style="margin-top:8px">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚</div>
      <div id="marketState" class="small" style="margin:-2px 0 8px 0;opacity:.95">Ø§Ù„Ø­Ø§Ù„Ø©: â€”</div>
      <canvas id="chart"></canvas>
      <div class="small">Ø§Ù„Ø£Ø²Ø±Ù‚ = Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­ÙŠ â€¢ Ø§Ù„Ø£Ø¨ÙŠØ¶ = Ø¯Ø®ÙˆÙ„ â€¢ Ø§Ù„Ø£Ø­Ù…Ø± = SL â€¢ Ø§Ù„Ø£Ø®Ø¶Ø± = TP1/TP2</div>

      <div class="row" style="gap:10px;margin-top:10px">
        <label class="chip"><input id="showBB" type="checkbox" checked> BB</label>
        <label class="chip"><input id="showMacd" type="checkbox" checked> MACD</label>
        <label class="chip"><input id="showRsi" type="checkbox" checked> RSI</label>
        <label class="chip"><input id="showStoch" type="checkbox"> Stoch</label>
      </div>
      <canvas id="macdPanel" style="margin-top:8px;height:140px"></canvas>
      <canvas id="rsiPanel" style="margin-top:8px;height:120px"></canvas>
      <canvas id="stochPanel" style="margin-top:8px;height:120px;display:none"></canvas>
    </section>

    <!-- Indicators -->
    <section id="tab-ind" class="tab card" style="display:none">
      <div class="title">Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</div>
      <div class="row" style="gap:8px">
        <span class="chip">ADX: <b id="adxVal">â€”</b></span>
        <span class="chip">RSI(<span id="rsiPLabel">14</span>): <b id="rsiVal">â€”</b></span>
        <span class="chip">MACD(<span id="macdFLabel">12</span>,<span id="macdSLabel">26</span>,<span id="macdSigLabel">9</span>): <b id="macdVal">â€”</b></span>
        <span class="chip">Stoch(<span id="stochKLabel">14</span>,<span id="stochDLabel">3</span>): <b id="stochVal">â€”</b></span>
        <span class="chip">EMA Ø³Ø±ÙŠØ¹: <b id="emaFast">â€”</b></span>
        <span class="chip">EMA Ø¨Ø·ÙŠØ¡: <b id="emaSlow">â€”</b></span>
        <span class="chip">BB Width%: <b id="bbWidth">â€”</b></span>
        <span class="chip">Regime: <b id="regimeBadge">â€”</b></span>
      </div>

      <div class="title" style="margin-top:8px">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹</div>
      <div class="row" style="gap:8px;margin-bottom:8px">
        <label class="chip"><input type="radio" name="mode" id="modeSmart" checked> Ø°ÙƒÙŠ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)</label>
        <label class="chip"><input type="radio" name="mode" id="modeFast"> Ø³Ø±ÙŠØ¹</label>
        <label class="chip"><input type="radio" name="mode" id="modeSafe"> Ø­Ø°Ø±</label>
      </div>

      <div class="title" style="margin-top:8px">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙŠØ¯ÙˆÙŠØ©</div>
      <div class="row" style="gap:10px">
        <label class="chip">ATR
          <select id="atrMode"><option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option><option value="manual">ÙŠØ¯ÙˆÙŠ</option></select>
          <input id="atrPeriod" type="number" value="14" min="2" max="300" disabled>
          <span>Ø§Ù„Ù‚ÙŠÙ…Ø©: <b id="atrVal">â€”</b></span>
        </label>
        <label class="chip">BB
          <select id="bbMode"><option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option><option value="manual">ÙŠØ¯ÙˆÙŠ</option></select>
          <input id="bbPeriod" type="number" value="20" min="5" max="400" disabled>
          <input id="bbStd" type="number" value="2" min="0.5" max="6" step="0.5" disabled>
          <span>MA:<b id="bbMA">â€”</b> U:<b id="bbUp">â€”</b> L:<b id="bbLo">â€”</b></span>
        </label>
        <label class="chip">EMA
          <select id="emaMode"><option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option><option value="manual">ÙŠØ¯ÙˆÙŠ</option></select>
          <input id="emaFastIn" type="number" value="10" min="2" max="200" disabled>
          <input id="emaSlowIn" type="number" value="34" min="3" max="400" disabled>
          <input id="emaOn" type="checkbox" checked> Ø¥Ø¯Ø±Ø§Ø¬
        </label>
        <label class="chip">RSI
          <select id="rsiMode"><option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option><option value="manual">ÙŠØ¯ÙˆÙŠ</option></select>
          <input id="rsiPeriod" type="number" value="14" min="2" max="200" disabled>
          <input id="rsiOn" type="checkbox" checked> Ø¥Ø¯Ø±Ø§Ø¬
        </label>
        <label class="chip">MACD
          <select id="macdMode"><option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option><option value="manual">ÙŠØ¯ÙˆÙŠ</option></select>
          <input id="macdFast" type="number" value="12" min="2" max="200" disabled>
          <input id="macdSlow" type="number" value="26" min="3" max="400" disabled>
          <input id="macdSig" type="number" value="9" min="2" max="200" disabled>
          <input id="macdOn" type="checkbox" checked> Ø¥Ø¯Ø±Ø§Ø¬
        </label>
        <label class="chip">Stoch
          <select id="stochMode"><option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option><option value="manual">ÙŠØ¯ÙˆÙŠ</option></select>
          <input id="stochK" type="number" value="14" min="2" max="200" disabled>
          <input id="stochD" type="number" value="3" min="1" max="200" disabled>
          <input id="stochOn" type="checkbox" checked> Ø¥Ø¯Ø±Ø§Ø¬
        </label>
      </div>
    </section>

    <!-- Advice -->
    <section id="tab-adv" class="tab card" style="display:none">
      <div class="title">Ù†ØµÙŠØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„Ø®Ø±ÙˆØ¬</div>
      <div id="adviceCard" class="card" style="background:var(--card2)">
        <div class="value" id="adviceText">â€”</div>
        <div class="row" style="margin-top:8px;gap:12px">
          <span class="chip">Ø§Ù„ÙˆØ«ÙˆÙ‚ÙŠØ©: <b id="confVal">â€”</b></span>
          <span class="chip">Ø§Ù„Ø¯Ø®ÙˆÙ„: <b id="entryVal">â€”</b></span>
          <span class="chip" style="color:var(--ok);border-color:var(--ok)">TP1: <b id="tp1Val">â€”</b></span>
          <span class="chip" style="color:var(--ok);border-color:var(--ok)">TP2: <b id="tp2Val">â€”</b></span>
          <span class="chip" style="color:var(--bad);border-color:var(--bad)">SL: <b id="slVal">â€”</b></span>
        </div>
        <div class="title" style="margin-top:8px">Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨</div>
        <ul id="reasonsList"></ul>
        <div class="row" style="margin-top:8px">
          <button id="btnNotify" class="primary">Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ ØªÙŠÙ„ÙŠØºØ±Ø§Ù…</button>
          <button id="btnRecalc">Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨</button>
        </div>
      </div>
      <div class="title" style="margin-top:6px">Debug</div>
      <label class="chip"><input id="dbgToggle" type="checkbox"> Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡</label>
      <div id="log" style="display:none"></div>
    </section>

    <!-- Backtest -->
    <section id="tab-bt" class="tab card" style="display:none">
      <div class="title">Backtest Ø³Ø±ÙŠØ¹</div>
      <div class="row">
        <button id="btnBacktest">ØªØ´ØºÙŠÙ„ Backtest</button>
        <input id="csvFile" type="file" accept=".csv">
      </div>
      <div class="row" style="gap:12px;margin-top:6px">
        <span class="chip">Ø§Ù„ØµÙÙ‚Ø§Øª: <b id="btTrades">â€”</b></span>
        <span class="chip">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b id="btPL">â€”</b></span>
        <span class="chip">Win%: <b id="btWin">â€”</b></span>
        <span class="chip">MaxDD: <b id="btDD">â€”</b></span>
      </div>
    </section>

    <!-- Pivot -->
    <section id="tab-pivot" class="tab card" style="display:none">
      <div class="title">ğŸ“Š Pivot Levels</div>
      <div class="small">ØªÙØ­Ø¯Ù‘ÙØ« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø¢Ø®Ø± Ø´Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­ÙŠ.</div>
      <table class="nice-table" id="pivotTable" style="margin-top:8px">
        <thead>
          <tr><th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ÙØ±Ù‚ Ø¹Ù† Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ØªÙØ³ÙŠØ±</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="pivotPrice" class="small" style="margin-top:6px"></div>
    </section>
  </main>

  <nav class="tabs">
    <button data-tab="home" class="active">ğŸ“ˆ Ø§Ù„Ø´Ù…ÙˆØ¹</button>
    <button data-tab="ind">âš™ï¸ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª</button>
    <button data-tab="adv">ğŸ’¬ Ø§Ù„Ù†ØµÙŠØ­Ø©</button>
    <button data-tab="bt">ğŸ§ª Backtest</button>
    <button data-tab="pivot">ğŸ“Š Pivot Levels</button>
  </nav>

  <!-- Theme + Tabs -->
  <script>
    const btn = document.getElementById('themeBtn');
    const apply = (mode)=>{
      document.documentElement.classList.toggle('light', mode==='light');
      btn.textContent = (mode==='light' ? 'ğŸŒ' : 'ğŸŒ™');
      localStorage.setItem('gsx.theme', mode);
    };
    const saved = localStorage.getItem('gsx.theme') || 'dark';
    apply(saved);
    btn.addEventListener('click', ()=>{
      const cur = document.documentElement.classList.contains('light') ? 'light' : 'dark';
      apply(cur==='light' ? 'dark' : 'light');
    });

    document.querySelectorAll('nav.tabs button').forEach(b=>b.addEventListener('click', ()=>{
      document.querySelectorAll('nav.tabs button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      const tab = b.dataset.tab;
      document.querySelectorAll('main .tab').forEach(s=>s.style.display='none');
      document.getElementById('tab-'+tab).style.display='block';
      window.scrollTo({ top:0, behavior:'smooth' });
    }));
  </script>

  <div id="flash"></div>
  <div id="toast" role="status" aria-live="polite">
    <div class="t-row">
      <div>ğŸ””</div>
      <div style="flex:1">
        <div class="t-title" id="toastTitle">ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø´Ø§Ø±Ø©</div>
        <div class="small" id="toastMsg">â€”</div>
      </div>
      <button class="t-btn" id="toastClose">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <!-- Lightweight Charts + App -->
  <script src="https://unpkg.com/lightweight-charts@4.2.0/dist/lightweight-charts.standalone.production.js"></script>
  <script src="./src/ui/app_mobile.js"></script>
</body>
</html>
