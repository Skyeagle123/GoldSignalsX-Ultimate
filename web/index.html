<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>GoldSignalsX • Ultimate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA basics (استعمل manifest و service-worker اللي عندك) -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#050810" />

  <style>
    :root {
      color-scheme: dark;
      --bg: #050810;
      --bg-elevated: #0c111c;
      --bg-soft: #111827;
      --bg-softer: #020617;
      --border-subtle: #1e293b;
      --accent: #fbbf24;
      --accent-soft: rgba(251, 191, 36, 0.15);
      --accent-strong: #f59e0b;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .gsx-root {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 10px 40px;
    }

    header.gsx-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .gsx-logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .gsx-logo-circle {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fde68a, #f97316);
      box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
      position: relative;
    }
    .gsx-logo-circle::after {
      content: "";
      position: absolute;
      inset: 26%;
      border-radius: inherit;
      border: 2px solid rgba(15,23,42,0.9);
      box-shadow: inset 0 0 0 1px rgba(15,23,42,0.7);
    }
    .gsx-logo-text {
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .gsx-logo-text strong {
      font-size: 15px;
      letter-spacing: 0.03em;
    }
    .gsx-logo-text span {
      font-size: 11px;
      color: var(--text-soft);
    }

    .gsx-header-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .pill {
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: var(--text-soft);
      white-space: nowrap;
    }
    .pill strong { color: var(--accent); }

    .pill-badge {
      border-radius: 999px;
      padding: 3px 7px;
      background: var(--accent-soft);
      color: var(--accent-strong);
      font-size: 10px;
      border: 1px solid rgba(251,191,36,0.4);
    }

    /* Live price */
    .gsx-price-box {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(120deg, #0f172a, #020617);
      border: 1px solid #1f2937;
      box-shadow: 0 0 20px rgba(15,23,42,0.8);
      min-width: 140px;
    }
    .gsx-price-label {
      font-size: 11px;
      color: var(--text-soft);
    }
    .gsx-price-value {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
      font-size: 14px;
    }
    .gsx-price-source {
      font-size: 10px;
      color: var(--text-soft);
    }
    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.9);
    }
    .dot.off {
      background: #f97373;
      box-shadow: 0 0 8px rgba(248,113,113,0.8);
    }

    /* Controls row */
    .gsx-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }
    .gsx-card {
      background: radial-gradient(circle at top left, #111827, #020617);
      border-radius: 14px;
      padding: 8px 10px;
      border: 1px solid rgba(15,23,42,0.9);
      box-shadow:
        0 18px 45px rgba(15,23,42,0.7),
        0 0 0 1px rgba(15,23,42,0.9);
    }
    .gsx-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .gsx-card-header span {
      font-size: 11px;
      color: var(--text-soft);
    }
    .gsx-card-header strong {
      font-size: 12px;
    }

    .segmented {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(30,64,175,0.8);
      background: rgba(15,23,42,0.9);
      overflow: hidden;
    }
    .segmented button {
      border: none;
      padding: 4px 10px;
      font-size: 11px;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      font-family: inherit;
    }
    .segmented button.active {
      background: linear-gradient(120deg, #1d4ed8, #0ea5e9);
      color: white;
    }

    select, button, input[type="number"], input[type="text"] {
      background: #020617;
      border-radius: 999px;
      border: 1px solid #1f2937;
      color: var(--text-main);
      font-size: 11px;
      padding: 4px 10px;
      font-family: inherit;
      outline: none;
    }
    select:focus, input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37,99,235,0.4);
    }
    button {
      cursor: pointer;
    }
    button.primary {
      background: linear-gradient(120deg, #fbbf24, #f97316);
      border-color: rgba(251,191,36,0.5);
      color: #111827;
      font-weight: 600;
    }
    button.primary:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .gsx-controls-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 130px;
    }
    .gsx-controls-label {
      font-size: 11px;
      color: var(--text-soft);
    }

    /* Layout main: chart + right panel */
    .gsx-main {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
      gap: 10px;
      margin-top: 4px;
    }
    @media (max-width: 880px) {
      .gsx-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .gsx-chart-card {
      min-height: 360px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .chart-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .chart-header-row span strong {
      color: var(--accent);
      margin-inline-start: 4px;
    }

    #chart-root {
      flex: 1;
      min-height: 280px;
      border-radius: 12px;
      background: radial-gradient(circle at top, #020617, #020617 60%);
      border: 1px solid #1f2937;
      overflow: hidden;
      position: relative;
    }
    #chart-root::before {
      content: "جارِ تحميل الشموع…";
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #4b5563;
      pointer-events: none;
    }
    #chart-root.ready::before {
      content: "";
      display: none;
    }

    .mini-indicators-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 10px;
      color: var(--text-soft);
    }
    .mini-indicators-row span {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(15,23,42,0.9);
    }
    .mini-indicators-row span b {
      color: var(--accent);
      margin-inline-start: 3px;
    }

    /* Right panel: advice + regime + candles + pivots */
    .gsx-right {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .gsx-advice {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .advice-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .advice-title {
      font-size: 12px;
      font-weight: 600;
    }
    .advice-mode-pill {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(37,99,235,0.2);
      border: 1px solid rgba(37,99,235,0.6);
      color: #bfdbfe;
    }
    .advice-body {
      font-size: 12px;
      line-height: 1.5;
      background: radial-gradient(circle at top left, #020617, #020617 55%);
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid #1f2937;
      position: relative;
      overflow: hidden;
    }
    .advice-body::before {
      content: "";
      position: absolute;
      inset-inline-end: -40px;
      inset-block-start: -40px;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle at center, rgba(248,250,252,0.12), transparent 65%);
      opacity: 0.7;
      pointer-events: none;
    }
    .advice-line-main {
      font-weight: 600;
      color: #e5e7eb;
      margin-bottom: 4px;
    }
    .advice-line-extra {
      font-size: 11px;
      color: var(--text-soft);
    }
    .advice-points {
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 4px;
    }
    .advice-points li {
      margin-bottom: 2px;
    }

    .gsx-badges-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 10px;
    }
    .gsx-badges-row span {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(15,23,42,0.9);
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }
    .badge-dot.warn { background: #f59e0b; }
    .badge-dot.danger { background: #ef4444; }

    .gsx-subcard {
      border-radius: 12px;
      border: 1px solid #111827;
      background: rgba(15,23,42,0.9);
      padding: 6px 8px;
      font-size: 11px;
    }
    .gsx-subcard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
      color: var(--text-soft);
    }
    .gsx-subcard-header strong {
      font-size: 11px;
      color: var(--text-main);
    }
    .gsx-subcard-body {
      font-size: 11px;
      color: var(--text-soft);
    }

    .gsx-table-wrapper {
      max-height: 150px;
      overflow: auto;
      border-radius: 8px;
      border: 1px solid #111827;
      background: #020617;
      margin-top: 4px;
    }
    table.gsx-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10px;
      min-width: 100%;
    }
    table.gsx-table thead {
      background: #020617;
      position: sticky;
      inset-block-start: 0;
      z-index: 1;
    }
    table.gsx-table th, table.gsx-table td {
      padding: 4px 6px;
      border-bottom: 1px solid #020617;
      text-align: center;
      white-space: nowrap;
    }
    table.gsx-table th {
      color: var(--text-soft);
      font-weight: 500;
    }
    table.gsx-table td {
      color: var(--text-main);
    }

    /* Tabs: Main / Backtest / Debug */
    .gsx-tabs {
      display: flex;
      gap: 4px;
      margin-top: 10px;
      margin-bottom: 6px;
    }
    .gsx-tabs button {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid #1f2937;
      background: rgba(15,23,42,0.9);
      font-size: 11px;
      color: var(--text-soft);
    }
    .gsx-tabs button.active {
      border-color: rgba(251,191,36,0.7);
      background: linear-gradient(120deg, #fbbf24, #f97316);
      color: #111827;
      font-weight: 600;
    }

    .gsx-tab-panel {
      display: none;
    }
    .gsx-tab-panel.active {
      display: block;
    }

    /* Backtest panel */
    .backtest-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 6px;
      font-size: 11px;
    }
    .backtest-controls > div {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 120px;
    }
    .backtest-results {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 6px;
    }

    /* Debug panel */
    .debug-log {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 10px;
      line-height: 1.5;
      background: #020617;
      border-radius: 8px;
      border: 1px solid #111827;
      padding: 6px;
      max-height: 180px;
      overflow: auto;
      white-space: pre-wrap;
    }

    footer {
      margin-top: 16px;
      font-size: 10px;
      color: var(--text-soft);
      text-align: center;
      opacity: 0.7;
    }
  </style>

  <script>
    // عنوان الووركر تبعك – استعمله datafeed.js / app_mobile.js
    window.GSX_WORKER_BASE = "https://goldsignalsx-worker.samer-mourtada.workers.dev";

    // تحديث ثيم (Dark / Light) إذا حابب توسّع لاحقاً
    window.GSX_THEME = "dark";

    // إعدادات افتراضية
    window.GSX_DEFAULT_TF = "15m";
    window.GSX_DEFAULT_LIMIT = 800;
  </script>

  <!-- سكربتات المشروع (نفس الأسماء اللي عندك) -->
  <script src="datafeed.js" defer></script>
  <script src="indicators.js" defer></script>
  <script src="candles.js" defer></script>
  <script src="regime.js" defer></script>
  <script src="fuse.js" defer></script>
  <script src="backtest.js" defer></script>
  <script src="app_mobile.js" defer></script>
</head>
<body>
  <div class="gsx-root">
    <!-- HEADER -->
    <header class="gsx-header">
      <div class="gsx-logo">
        <div class="gsx-logo-circle"></div>
        <div class="gsx-logo-text">
          <strong>GoldSignalsX</strong>
          <span>Ultimate Candles • XAUUSD</span>
        </div>
      </div>

      <div class="gsx-header-right">
        <div class="pill">
          <span>حالة السوق:</span>
          <strong id="regime-label">جارِ التحليل…</strong>
        </div>

        <div class="pill">
          <span>وضع الإشارات:</span>
          <span id="mode-label" class="pill-badge">Smart</span>
        </div>

        <div class="gsx-price-box">
          <div class="dot" id="price-dot"></div>
          <div>
            <div class="gsx-price-label">السعر الحي</div>
            <div class="gsx-price-value" id="live-price">--.--</div>
            <div class="gsx-price-source" id="live-price-source">—</div>
          </div>
        </div>
      </div>
    </header>

    <!-- CONTROLS -->
    <div class="gsx-controls gsx-card">
      <!-- TF + limit -->
      <div class="gsx-controls-group">
        <div class="gsx-controls-label">الإطار الزمني</div>
        <div style="display:flex; gap:4px; align-items:center; flex-wrap:wrap;">
          <select id="tf-select">
            <option value="1m">1 دقيقة</option>
            <option value="5m">5 دقائق</option>
            <option value="15m" selected>15 دقيقة</option>
            <option value="30m">30 دقيقة</option>
            <option value="60m">ساعة</option>
            <option value="240m">4 ساعات</option>
            <option value="1d">يومي</option>
          </select>
          <span style="font-size:10px; color:var(--text-soft);">#الشموع:</span>
          <input id="limit-input" type="number" min="100" max="5000" value="800" style="width:70px;" />
        </div>
      </div>

      <!-- Mode: Fast / Smart / Cautious -->
      <div class="gsx-controls-group">
        <div class="gsx-controls-label">نمط الإشارات</div>
        <div class="segmented" id="mode-segmented">
          <button data-mode="fast">سريع</button>
          <button data-mode="smart" class="active">ذكي</button>
          <button data-mode="cautious">حذر</button>
        </div>
      </div>

      <!-- Filters -->
      <div class="gsx-controls-group">
        <div class="gsx-controls-label">الفلاتر</div>
        <div style="display:flex; flex-wrap:wrap; gap:4px;">
          <label class="pill" style="cursor:pointer;">
            <input id="filter-ny" type="checkbox" style="margin:0 0 0 4px; accent-color:#facc15;" />
            جلسة نيويورك
          </label>
          <label class="pill" style="cursor:pointer;">
            <input id="filter-pivot" type="checkbox" style="margin:0 0 0 4px; accent-color:#facc15;" />
            قرب Pivot / دعم / مقاومة
          </label>
        </div>
      </div>

      <!-- Candle patterns / Debug -->
      <div class="gsx-controls-group">
        <div class="gsx-controls-label">إعدادات إضافية</div>
        <div style="display:flex; flex-wrap:wrap; gap:4px;">
          <label class="pill" style="cursor:pointer;">
            <input id="filter-candles" type="checkbox" checked style="margin:0 0 0 4px; accent-color:#f97316;" />
            دمج أنماط الشموع
          </label>
          <label class="pill" style="cursor:pointer;">
            <input id="toggle-debug" type="checkbox" style="margin:0 0 0 4px; accent-color:#22c55e;" />
            Debug
          </label>
        </div>
      </div>

      <!-- Fetch button -->
      <div class="gsx-controls-group" style="min-width:140px;">
        <div class="gsx-controls-label">تحديث البيانات</div>
        <div style="display:flex; gap:4px; flex-wrap:wrap;">
          <button id="btn-refresh" class="primary">تحديث الشموع</button>
          <button id="btn-import" type="button">Import CSV → D1</button>
        </div>
        <input id="csv-file-input" type="file" accept=".csv" style="display:none;" />
      </div>
    </div>

    <!-- TABS -->
    <div class="gsx-tabs">
      <button class="active" data-tab="main">الرئيسية</button>
      <button data-tab="backtest">Backtest</button>
      <button data-tab="debug">Debug</button>
    </div>

    <!-- MAIN PANEL -->
    <div id="tab-main" class="gsx-tab-panel active">
      <div class="gsx-main">
        <!-- CHART SIDE -->
        <div class="gsx-card gsx-chart-card">
          <div class="chart-header-row">
            <span>الشموع: <strong id="candles-count">0</strong></span>
            <span>آخر تحديث: <strong id="last-update">—</strong></span>
          </div>

          <div id="chart-root"></div>

          <div class="mini-indicators-row" id="mini-indicators">
            <span>EMA21: <b id="mini-ema21">—</b></span>
            <span>RSI(14): <b id="mini-rsi14">—</b></span>
            <span>ATR(14): <b id="mini-atr14">—</b></span>
            <span>BB Width: <b id="mini-bbwidth">—</b></span>
            <span>MACD: <b id="mini-macd">—</b></span>
            <span>Stoch: <b id="mini-stoch">—</b></span>
          </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="gsx-right">
          <!-- ADVICE -->
          <div class="gsx-card gsx-advice">
            <div class="advice-header">
              <div class="advice-title">نصيحة الدخول / الخروج (تجريبية)</div>
              <div class="advice-mode-pill" id="advice-mode-pill">Smart</div>
            </div>
            <div class="advice-body">
              <div class="advice-line-main" id="advice-main">
                لا توجد صفقة واضحة حالياً – انتظر إشارة أنظف.
              </div>
              <div class="advice-line-extra" id="advice-extra">
                يتم توليد هذه النصيحة تلقائياً لأغراض تعليمية فقط، وليست توصية استثمارية أو مالية.
              </div>
              <ul class="advice-points" id="advice-points">
                <!-- نقط الشرح تضاف من السكربت -->
              </ul>
            </div>
          </div>

          <!-- BADGES: regime / candle / risk -->
          <div class="gsx-badges-row">
            <span>
              <span class="badge-dot" id="badge-regime-dot"></span>
              <span>حالة السوق:</span>
              <b id="badge-regime-text">جارِ التحليل…</b>
            </span>
            <span>
              <span class="badge-dot warn" id="badge-candle-dot"></span>
              <span>نمط الشمعة:</span>
              <b id="badge-candle-text">—</b>
            </span>
            <span>
              <span class="badge-dot danger" id="badge-risk-dot"></span>
              <span>درجة المخاطرة:</span>
              <b id="badge-risk-text">—</b>
            </span>
          </div>

          <!-- PIVOTS SUMMARY -->
          <div class="gsx-subcard">
            <div class="gsx-subcard-header">
              <strong>Pivot / دعوم / مقاومات</strong>
              <span id="pivot-summary-label">—</span>
            </div>
            <div class="gsx-subcard-body">
              <div class="gsx-table-wrapper">
                <table class="gsx-table">
                  <thead>
                    <tr>
                      <th>المستوى</th>
                      <th>السعر</th>
                      <th>البُعد عن السعر</th>
                    </tr>
                  </thead>
                  <tbody id="pivot-table-body">
                    <!-- Pivot rows from JS -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

        </div>
      </div> <!-- /gsx-main -->
    </div>

    <!-- BACKTEST TAB -->
    <div id="tab-backtest" class="gsx-tab-panel">
      <div class="gsx-card">
        <div class="gsx-card-header">
          <span>Backtest (تجريبي)</span>
          <span style="font-size:10px; color:var(--text-soft);">يستخدم نفس الإشارات المفعّلة على الصفحة الرئيسية.</span>
        </div>

        <div class="backtest-controls">
          <div>
            <span>عدد الشموع</span>
            <input id="bt-window" type="number" min="100" max="5000" value="800" />
          </div>
          <div>
            <span>ATR Risk Factor</span>
            <input id="bt-atr-mult" type="number" step="0.1" min="0.5" max="4" value="1.0" />
          </div>
          <div>
            <span>مُعامل TP2</span>
            <input id="bt-tp2-mult" type="number" step="0.5" min="1" max="5" value="2.5" />
          </div>
          <div style="align-self:flex-end;">
            <button id="btn-run-backtest" class="primary">تشغيل Backtest</button>
          </div>
        </div>

        <div class="backtest-results" id="backtest-results">
          لم يتم تشغيل backtest بعد.
        </div>
      </div>
    </div>

    <!-- DEBUG TAB -->
    <div id="tab-debug" class="gsx-tab-panel">
      <div class="gsx-card">
        <div class="gsx-card-header">
          <span>Debug / Log</span>
          <button id="btn-clear-log" type="button" style="font-size:10px;">مسح السجل</button>
        </div>
        <div class="debug-log" id="debug-log">
          Debug log فارغ.
        </div>
      </div>
    </div>

    <footer>
      GoldSignalsX • جميع القراءات والمؤشرات والنصائح لأغراض تعليمية وتجريبية فقط، وليست نصيحة استثمارية أو مالية حقيقية.
    </footer>
  </div>

  <!-- سكربت صغير لربط التبويبات + أزرار فقط -->
  <script>
    (function () {
      // Tabs
      const tabButtons = document.querySelectorAll(".gsx-tabs button");
      const tabPanels = document.querySelectorAll(".gsx-tab-panel");
      tabButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-tab");
          tabButtons.forEach(b => b.classList.toggle("active", b === btn));
          tabPanels.forEach(p => p.classList.toggle("active", p.id === "tab-" + id));
        });
      });

      // CSV import button
      const importBtn = document.getElementById("btn-import");
      const fileInput = document.getElementById("csv-file-input");
      if (importBtn && fileInput) {
        importBtn.addEventListener("click", () => fileInput.click());
      }

      // Mode segmented
      const modeSegmented = document.getElementById("mode-segmented");
      const modeLabel = document.getElementById("mode-label");
      const adviceModePill = document.getElementById("advice-mode-pill");
      if (modeSegmented) {
        modeSegmented.addEventListener("click", (e) => {
          if (e.target.tagName !== "BUTTON") return;
          const mode = e.target.getAttribute("data-mode");
          modeSegmented.querySelectorAll("button").forEach(b => b.classList.toggle("active", b === e.target));
          if (modeLabel) modeLabel.textContent = mode.charAt(0).toUpperCase() + mode.slice(1);
          if (adviceModePill) adviceModePill.textContent = modeLabel.textContent;
          // خلي app_mobile.js يقرأ window.GSX_MODE
          window.GSX_MODE = mode;
        });
        // افتراضي
        window.GSX_MODE = "smart";
      }

      // مبدئياً، خلي app_mobile.js هو اللي يعمل:
      // - جلب السعر الحي / الشموع عن طريق datafeed.js
      // - تحديث chart-root
      // - تعبئة المؤشرات + النصيحة + pivots + backtest + debug
      // المهم إن IDs كلها جاهزة هنا.
    })();
  </script>
</body>
</html>
