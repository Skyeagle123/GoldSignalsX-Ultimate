<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <script>
    if (!localStorage.getItem('GSX_BASE_URL')) {
      localStorage.setItem('GSX_BASE_URL', 'https://goldsignalsx-worker.samer-mourtada.workers.dev');
    }
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>GoldSignalsX â€“ Mobile</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0f17">
  <style>
    :root{
      color-scheme:dark;
      --bg:#020617;
      --bg-soft:#020617;
      --card:#020617;
      --card-2:#020617;
      --card-soft:#020617;
      --fg:#e5e7eb;
      --muted:#94a3b8;
      --accent:#22c55e;
      --accent-soft:rgba(34,197,94,.16);
      --danger:#ef4444;
      --danger-soft:rgba(248,113,113,.12);
      --border:#1f2937;
      --border-subtle:#111827;
      --chip-bg:rgba(15,23,42,.9);
      --tab-active:#0f172a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#020617 0,#020617 40%,#020617 100%);
      color:var(--fg);
      padding:10px;
    }
    body.dark{
      --bg:#020617;
    }
    body.light{
      --bg:#f9fafb;
      --card:#ffffff;
      --card-soft:#f3f4f6;
      --fg:#020617;
      --muted:#6b7280;
      --accent:#16a34a;
      --accent-soft:rgba(22,163,74,.12);
      --danger:#b91c1c;
      --danger-soft:rgba(185,28,28,.1);
      --border:#e5e7eb;
      --border-subtle:#e5e7eb;
      --chip-bg:#f3f4f6;
      --tab-active:#e5e7eb;
    }
    body{
      background-color:var(--bg);
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 10px;
      background:linear-gradient(to right,rgba(15,23,42,.95),rgba(15,23,42,.92));
      border-radius:18px;
      border:1px solid rgba(30,64,175,.7);
      box-shadow:0 18px 40px rgba(15,23,42,.9);
      margin-bottom:10px;
    }
    header .brand{
      display:flex;
      align-items:center;
      gap:8px;
    }
    header .brand .icon{
      width:32px;
      height:32px;
      border-radius:999px;
      background:radial-gradient(circle at top left,rgba(34,197,94,.5),rgba(37,99,235,.7));
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      box-shadow:0 0 0 1px rgba(15,23,42,1),0 10px 25px rgba(15,23,42,1);
    }
    header .brand h1{
      margin:0;
      font-size:16px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    header .brand .sub{
      font-size:11px;
      color:var(--muted);
    }
    header .right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:4px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:3px 8px;
      border-radius:999px;
      background:var(--chip-bg);
      border:1px solid rgba(31,41,55,.9);
      font-size:11px;
    }
    .chip b{font-weight:600}
    .small{font-size:10px;color:var(--muted)}
    #liveDateTime{font-size:10px}
    #themeBtn{
      border-radius:999px;
      border:1px solid rgba(31,41,55,.9);
      background:rgba(15,23,42,.95);
      color:var(--fg);
      padding:3px 7px;
      font-size:12px;
      cursor:pointer;
    }
    main{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .card{
      background:radial-gradient(circle at top left,rgba(15,23,42,.95),rgba(15,23,42,1));
      border-radius:18px;
      border:1px solid var(--border);
      padding:10px;
      box-shadow:0 18px 40px rgba(15,23,42,.9);
    }
    .title{
      font-size:13px;
      font-weight:600;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .title .badge{
      font-size:10px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.9);
      color:var(--muted);
    }
    .row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
      margin-bottom:6px;
    }
    label{
      font-size:11px;
      color:var(--muted);
    }
    input,select{
      font-size:11px;
      padding:4px 6px;
      border-radius:10px;
      border:1px solid var(--border-subtle);
      background:rgba(15,23,42,.95);
      color:var(--fg);
      min-width:0;
    }
    body.light input,body.light select{
      background:#f9fafb;
      border-color:#d1d5db;
    }
    input:focus,select:focus{
      outline:none;
      border-color:#3b82f6;
      box-shadow:0 0 0 1px rgba(37,99,235,.6);
    }
    button{
      font-size:11px;
      border-radius:999px;
      border:1px solid rgba(55,65,81,.9);
      background:rgba(15,23,42,.98);
      color:var(--fg);
      padding:4px 9px;
      cursor:pointer;
    }
    button.primary{
      border-color:rgba(59,130,246,.9);
      background:radial-gradient(circle at top left,rgba(59,130,246,.55),rgba(15,23,42,.96));
      color:#eff6ff;
      box-shadow:0 0 0 1px rgba(15,23,42,.95),0 10px 24px rgba(15,23,42,.95);
    }
    button.danger{
      border-color:rgba(248,113,113,.9);
      background:var(--danger-soft);
      color:#fecaca;
    }
    .tabs{
      display:flex;
      gap:6px;
      margin-bottom:8px;
      overflow-x:auto;
      padding-bottom:2px;
    }
    .tabs button{
      white-space:nowrap;
      background:transparent;
    }
    .tabs button.active{
      background:var(--tab-active);
      border-color:rgba(59,130,246,.8);
      color:#bfdbfe;
    }
    canvas{
      max-width:100%;
    }
    #chartWrap{
      width:100%;
      height:260px;
      border-radius:16px;
      border:1px solid var(--border-subtle);
      background:#020617;
      overflow:hidden;
    }
    #bbWrap,#macdWrap,#stochWrap{
      width:100%;
      height:120px;
      border-radius:14px;
      border:1px solid var(--border-subtle);
      background:#020617;
      overflow:hidden;
      margin-top:6px;
    }
    .stats-row{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:6px;
    }
    .stats-row .chip{
      font-size:10px;
    }
    .signal-badge{
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      display:inline-flex;
      align-items:center;
      gap:6px;
      border:1px solid rgba(55,65,81,.95);
      background:rgba(15,23,42,.97);
    }
    .signal-badge .dot{
      width:7px;
      height:7px;
      border-radius:999px;
      background:#22c55e;
      box-shadow:0 0 0 4px rgba(34,197,94,.25);
    }
    .signal-badge.sell .dot{
      background:#ef4444;
      box-shadow:0 0 0 4px rgba(239,68,68,.25);
    }
    .signal-badge.flat .dot{
      background:#9ca3af;
      box-shadow:0 0 0 4px rgba(148,163,184,.25);
    }
    .nice-table{
      width:100%;
      border-collapse:collapse;
      font-size:11px;
      margin-top:6px;
    }
    .nice-table th,
    .nice-table td{
      border-bottom:1px solid var(--border-subtle);
      padding:4px 4px;
      text-align:right;
    }
    .nice-table th{
      background:var(--card);
    }
    .nice-table tr:nth-child(even){
      background-color:rgba(255,255,255,.03);
    }
    .nice-table .pivot{
      color:#facc15;
      font-weight:800;
    }
    .nice-table .res{
      color:#f87171;
    }
    .nice-table .sup{
      color:#4ade80;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="icon">ğŸ”±</div>
      <div>
        <h1>GoldSignalsX</h1>
        <div class="sub">Smart Gold Trading Signals</div>
      </div>
    </div>
    <div class="right">
      <span class="chip">Ø§Ù„Ø³Ø¹Ø±: <b id="price">â€”</b>
        <div id="liveDateTime" class="small" style="opacity:.9;margin-top:2px">â€”</div>
      </span>
      <button id="themeBtn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…">ğŸŒ™</button>
    </div>
  </header>

  <main>
    <!-- Home / Chart -->
    <section id="tab-home" class="tab card">
      <div class="row">
        <label>Worker URL</label>
        <input id="base" size="28" placeholder="https://goldsignalsx-worker.yourname.workers.dev">
        <button id="saveBase" class="primary">Ø­ÙØ¸</button>
      </div>
      <div class="row small">
        <span>Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ù„ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (worker Ø§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠ).</span>
      </div>

      <div class="tabs" id="tfBar">
        <button data-tf="1m">1m</button>
        <button data-tf="5m" class="primary">5m</button>
        <button data-tf="15m">15m</button>
        <button data-tf="30m">30m</button>
        <button data-tf="1h">1h</button>
        <button data-tf="4h">4h</button>
        <button data-tf="1d">1D</button>
      </div>

      <div id="chartWrap"></div>
      <div id="bbWrap"></div>
      <div id="macdWrap"></div>
      <div id="stochWrap"></div>

      <div class="stats-row">
        <span class="chip">ATR: <b id="atrVal">â€”</b></span>
        <span class="chip">ATR%: <b id="atrPct">â€”</b></span>
        <span class="chip">Regime: <b id="regimeBadge">â€”</b></span>
        <span class="chip">BB Width%: <b id="bbWidth">â€”</b></span>
        <span class="chip">RSI: <b id="rsiVal">â€”</b></span>
        <span class="chip">MACD: <b id="macdVal">â€”</b></span>
        <span class="chip">Stoch: <b id="stochVal">â€”</b></span>
      </div>

      <div style="margin-top:6px">
        <span id="signalBadge" class="signal-badge flat">
          <span class="dot"></span>
          <span id="signalText">Ù„Ø§ Ø¥Ø´Ø§Ø±Ø© ÙˆØ§Ø¶Ø­Ø© Ø¨Ø¹Ø¯</span>
        </span>
      </div>

      <div class="title" style="margin-top:8px">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹</div>
      <div class="row">
        <label class="chip">
          <input type="radio" name="mode" value="scalp" checked> Scalping
        </label>
        <label class="chip">
          <input type="radio" name="mode" value="intraday"> Intraday
        </label>
        <label class="chip">
          <input type="radio" name="mode" value="swing"> Swing
        </label>
      </div>

      <div class="title" style="margin-top:8px">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙŠØ¯ÙˆÙŠØ©</div>
      <div class="row" style="gap:10px">
        <label class="chip">ATR
          <select id="atrMode">
            <option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
            <option value="manual">ÙŠØ¯ÙˆÙŠ</option>
          </select>
          <input id="atrPeriod" type="number" value="14" min="2" max="300" disabled>
          <span>Ø§Ù„Ù‚ÙŠÙ…Ø©: <b id="atrVal2">â€”</b></span>
        </label>
        <label class="chip">BB
          <select id="bbMode">
            <option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
            <option value="manual">ÙŠØ¯ÙˆÙŠ</option>
          </select>
          <input id="bbPeriod" type="number" value="20" min="5" max="400" disabled>
          <input id="bbStd" type="number" value="2" min="0.5" max="6" step="0.5" disabled>
          <span>MA:<b id="bbMA">â€”</b> U:<b id="bbUp">â€”</b> L:<b id="bbLo">â€”</b></span>
        </label>
        <label class="chip">EMA
          <select id="emaMode">
            <option value="auto" selected>ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
            <option value="manual">ÙŠØ¯ÙˆÙŠ</option>
          </select>
          <input id="emaFastIn" type="number" value="10" min="2" max="200" disabled>
          <input id="emaSlowIn" type="number" value="34" min="3" max="400" disabled>
          <input id="emaOn" type="checkbox" checked> Ø¥Ø¯Ø±Ø§Ø¬
        </label>
      </div>

      <div class="title" style="margin-top:8px">ØªØ´Ø®ÙŠØµ</div>
      <div class="row">
        <button id="btnFetchBars" class="primary">Ø¬Ù„Ø¨ Ø§Ù„Ø´Ù…ÙˆØ¹ (Ù…Ù† Ø§Ù„Ù€ Worker)</button>
        <button id="btnExportCSV">ØªØ­Ù…ÙŠÙ„ CSV</button>
        <button id="btnReload">Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„</button>
      </div>
      <div class="row small">
        <span>ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ D1 (1m) ÙÙŠ Ø§Ù„Ù€ workerØŒ Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¬Ù…ÙŠØ¹ Ù…Ø­Ù„ÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.</span>
      </div>

      <div class="title" style="margin-top:6px">Debug</div>
      <label class="chip"><input id="dbgToggle" type="checkbox"> Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡</label>
      <div id="log" style="display:none"></div>
    </section>

    <!-- Backtest -->
    <section id="tab-bt" class="tab card" style="display:none">
      <div class="title">Backtest Ø³Ø±ÙŠØ¹</div>
      <div class="row">
        <button id="btnBacktest">ØªØ´ØºÙŠÙ„ Backtest</button>
        <input id="csvFile" type="file" accept=".csv">
      </div>
      <div class="row" style="gap:12px;margin-top:6px">
        <span class="chip">Ø§Ù„ØµÙÙ‚Ø§Øª: <b id="btTrades">â€”</b></span>
        <span class="chip">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b id="btPL">â€”</b></span>
        <span class="chip">Win%: <b id="btWin">â€”</b></span>
        <span class="chip">MaxDD: <b id="btDD">â€”</b></span>
      </div>
    </section>

    <!-- Pivot Levels -->
    <section id="tab-pivot" class="tab card" style="display:none">
      <div class="title">ğŸ“Š Pivot Levels</div>
      <div class="small">ØªÙØ­Ø¯Ù‘ÙØ« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø¢Ø®Ø± Ø´Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­ÙŠ.</div>
      <table class="nice-table" id="pivotTable" style="margin-top:8px">
        <thead>
          <tr><th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„ÙØ±Ù‚ Ø¹Ù† Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ØªÙØ³ÙŠØ±</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="pivotPrice" class="small" style="margin-top:6px"></div>
    </section>

    <!-- Tabs -->
    <div class="tabs" id="tabsBar" style="margin-top:4px">
      <button data-tab="home" class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button data-tab="bt">Backtest</button>
      <button data-tab="pivot">Pivot</button>
    </div>
  </main>

  <!-- Lightweight Charts -->
  <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
  <!-- Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <script type="module" src="./src/ui/app_mobile.js"></script>

  <!-- GSX: safe fetch binding (Ù„Ø§ ØªÙ„Ù…Ø³Ù‡Ø§) -->
  <script>
  (function(){
    function bindFetchButtons(){
      const candidates = [];
      const byId1 = document.getElementById('fetchCandlesBtn');
      const byId2 = document.getElementById('fetchBtn');
      if (byId1) candidates.push(byId1);
      if (byId2) candidates.push(byId2);
      const buttons = Array.from(document.querySelectorAll('button'));
      const arBtn = buttons.find(b => (b.textContent||'').trim().match(/Ø¬Ù„Ø¨.*Ø§Ù„Ø´[Ù…Ùˆ]Ø¹/));
      if (arBtn) candidates.push(arBtn);
      const dataBtn = document.querySelector('[data-action="fetch"],[data-fetch="1"]');
      if (dataBtn) candidates.push(dataBtn);
      const seen = new Set();
      candidates.filter(Boolean).forEach(btn => {
        if (seen.has(btn)) return;
        seen.add(btn);
        try {
          btn.addEventListener('click', function(ev){
            try{ ev.preventDefault(); }catch(e){}
            window.dispatchEvent(new CustomEvent('gsx:fetch'));
          }, {passive:false});
        } catch(e){ /* ignore */ }
      });
    }
    if (document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', bindFetchButtons);
    } else {
      bindFetchButtons();
    }
  })();
  </script>
</body>
</html>
